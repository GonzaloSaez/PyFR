# -*- coding: utf-8 -*-

import numpy as np


class VTKHONodeMaps(object):
    """
    Mappings between the node ordering of PyFR and that of VTK>=9
    Lagrange cells

    Node mappings are contained within two dictionaries; one maps from
    VTK>=9 node ordering to PyFR, and the other provides the inverse.
    Dictionary items are keyed by a tuple of element type (string) and
    number of solution points per element (integer).

    WARNING
    VTK9 changed the connectivity mapping of vtkLagrangeHexahedron
    cells (see https://gitlab.kitware.com/vtk/vtk/-/merge_requests/6678)
    If the `VTKFile version` token of a given `vtu` or
    `pvtu` file is equal or greater than 2.1 then VTK9 supposes
    that the vtkLagrangeHexahedron cells are written with VTK9
    connectivity
    If not VTK>=9 will suppose that the connectivity is consistent with
    that of VTK8 and will reorder the nodes without the user noticing it.

    INFO: Only Paraview >= 5.9.0 is shipped with VTK>=9. Older versions might
    not be compatible with this implementation
    """

    from_pyfr = {
        ('quad', 4): np.array([0, 1, 3, 2]),
        ('quad', 9): np.array([0, 2, 8, 6, 1, 5, 7, 3, 4]),
        ('quad', 16): np.array([0,  3, 15, 12,  1,  2,  7, 11, 13, 14,  4,
                                8,  5,  6,  9, 10]),
        ('quad', 25): np.array([0,  4, 24, 20,  1,  2,  3,  9, 14, 19, 21,
                                22, 23,  5, 10, 15,  6,  7,  8, 11, 12, 13,
                                16, 17, 18]),
        ('quad', 36): np.array([0,  5, 35, 30,  1,  2,  3,  4, 11, 17, 23,
                                29, 31, 32, 33, 34,  6, 12, 18, 24,  7,  8,
                                9, 10, 13, 14, 15, 16, 19, 20, 21, 22, 25,
                                26, 27, 28]),
        ('hex', 8): np.array([0, 1, 3, 2, 4, 5, 7, 6]),
        ('hex', 27): np.array([0,  2,  8,  6, 18, 20, 26, 24,  1,  5,  7,  3,
                               19, 23, 25, 21,  9, 11, 17, 15, 12, 14, 10, 16,
                               4, 22, 13]),
        ('hex', 64): np.array([0,  3, 15, 12, 48, 51, 63, 60,  1,  2,  7, 11,
                               13, 14,  4,  8, 49, 50, 55, 59, 61, 62, 52, 56,
                               16, 32, 19, 35, 31, 47, 28, 44, 20, 24, 36, 40,
                               23, 27, 39, 43, 17, 18, 33, 34, 29, 30, 45, 46,
                               5,  6,  9, 10, 53, 54, 57, 58, 21, 22, 25, 26,
                               37, 38, 41, 42]),
        ('hex', 125): np.array([0,   4,  24,  20, 100, 104, 124, 120,   1,
                                2,   3,   9,  14,  19,  21,  22,  23,   5,
                                10,  15, 101, 102, 103, 109, 114, 119, 121,
                                122, 123, 105, 110, 115,  25,  50,  75,  29,
                                54,  79,  49,  74,  99,  45,  70,  95,  30,
                                35,  40,  55,  60,  65,  80,  85,  90,  34,
                                39,  44,  59,  64,  69,  84,  89,  94,  26,
                                27,  28,  51,  52,  53,  76,  77,  78,  46,
                                47,  48,  71,  72,  73,  96,  97,  98,   6,
                                7,   8,  11,  12,  13,  16,  17,  18, 106,
                                107, 108, 111, 112, 113, 116, 117, 118,  31,
                                32,  33,  36,  37,  38,  41,  42,  43,  56,
                                57,  58,  61,  62,  63,  66,  67,  68,  81,
                                82,  83,  86,  87,  88,  91,  92,  93]),
        ('hex', 216): np.array([0,   5,  35,  30, 180, 185, 215, 210,   1,
                                2,   3,   4,  11,  17,  23,  29,  31,  32,
                                33,  34,   6,  12,  18,  24, 181, 182, 183,
                                184, 191, 197, 203, 209, 211, 212, 213, 214,
                                186, 192, 198, 204,  36,  72, 108, 144,  41,
                                77, 113, 149,  71, 107, 143, 179,  66, 102,
                                138, 174,  42,  48,  54,  60,  78,  84,  90,
                                96, 114, 120, 126, 132, 150, 156, 162, 168,
                                47,  53,  59,  65,  83,  89,  95, 101, 119,
                                125, 131, 137, 155, 161, 167, 173,  37,  38,
                                39,  40,  73,  74,  75,  76, 109, 110, 111,
                                112, 145, 146, 147, 148,  67,  68,  69,  70,
                                103, 104, 105, 106, 139, 140, 141, 142, 175,
                                176, 177, 178,   7,   8,   9,  10,  13,  14,
                                15,  16,  19,  20,  21,  22,  25,  26,  27,
                                28, 187, 188, 189, 190, 193, 194, 195, 196,
                                199, 200, 201, 202, 205, 206, 207, 208,  43,
                                44,  45,  46,  49,  50,  51,  52,  55,  56,
                                57,  58,  61,  62,  63,  64,  79,  80,  81,
                                82,  85,  86,  87,  88,  91,  92,  93,  94,
                                97,  98,  99, 100, 115, 116, 117, 118, 121,
                                122, 123, 124, 127, 128, 129, 130, 133, 134,
                                135, 136, 151, 152, 153, 154, 157, 158, 159,
                                160, 163, 164, 165, 166, 169, 170, 171, 172]),
        ('tri', 3): np.array([2, 0, 1]),
        ('tri', 6): np.array([5, 0, 2, 3, 1, 4]),
        ('tri', 10): np.array([9, 0, 3, 7, 4, 1, 2, 6, 8, 5]),
        ('tri', 15): np.array([14,  0,  4, 12,  9,  5,  1,  2,  3,  8, 11, 13,
                               10,  6,  7]),
        ('tri', 21): np.array([20,  0,  5, 18, 15, 11,  6,  1,  2,  3,  4, 10,
                               14, 17, 19, 16,  7,  9, 12,  8, 13]),
        ('tet', 4): np.array([3, 0, 1, 2]),
        ('tet', 10): np.array([9, 0, 2, 5, 6, 1, 7, 8, 3, 4]),
        ('tet', 20): np.array([19,  0,  3,  9, 16, 10,  1,  2, 12, 17, 18, 15,
                               4,  7,  6,  8, 13,  5, 14, 11]),
        ('tet', 35): np.array([34,  0,  4, 14, 31, 25, 15,  1,  2,  3, 18, 27,
                               32, 33, 30, 24,  5,  9, 12,  8, 11, 13, 28, 19,
                               22,  7, 10,  6, 29, 23, 21, 26, 17, 16, 20]),
        ('tet', 56): np.array([55,  0,  5, 20, 52, 46, 36, 21,  1,  2,  3,  4,
                               25, 39, 48, 53, 54, 51, 45, 35,  6, 11, 15, 18,
                               10, 14, 17, 19, 49, 26, 33, 40, 30, 43,  9, 16,
                               7, 13, 12,  8, 50, 34, 29, 44, 32, 42, 47, 24,
                               22, 38, 23, 37, 41, 27, 28, 31]),
        ('pri', 6): np.array([0, 1, 2, 3, 4, 5]),
        ('pri', 18): np.array([0,  2,  5, 12, 14, 17,  1,  4,  3, 13, 16, 15,
                               6,  8, 11,  7, 10,  9]),
        ('pri', 40): np.array([0,  3,  9, 30, 33, 39,  1,  2,  6,  8,  7,  4,
                               31, 32, 36, 38, 37, 34, 10, 20, 13, 23, 19, 29,
                               5, 35, 11, 12, 21, 22, 16, 18, 26, 28, 17, 14,
                               27, 24, 15, 25]),
        ('pri', 75): np.array([0,  4, 14, 60, 64, 74,  1,  2,  3,  8, 11, 13,
                               12,  9,  5, 61, 62, 63, 68, 71, 73, 72, 69, 65,
                               15, 30, 45, 19, 34, 49, 29, 44, 59,  6,  7, 10,
                               66, 67, 70, 16, 17, 18, 31, 32, 33, 46, 47, 48,
                               23, 26, 28, 38, 41, 43, 53, 56, 58, 27, 24, 20,
                               42, 39, 35, 57, 54, 50, 21, 22, 25, 36, 37, 40,
                               51, 52, 55]),
        ('pri', 126): np.array([0,   5,  20, 105, 110, 125,   1,   2,   3,
                                4,  10,  14,  17,  19,  18,  15,  11,   6,
                                106, 107, 108, 109, 115, 119, 122, 124, 123,
                                120, 116, 111,  21,  42,  63,  84,  26,  47,
                                68,  89,  41,  62,  83, 104,   7,   8,   9,
                                12,  13,  16, 112, 113, 114, 117, 118, 121,
                                22,  23,  24,  25,  43,  44,  45,  46,  64,
                                65,  66,  67,  85,  86,  87,  88,  31,  35,
                                38,  40,  52,  56,  59,  61,  73,  77,  80,
                                82,  94,  98, 101, 103,  39,  36,  32,  27,
                                60,  57,  53,  48,  81,  78,  74,  69, 102,
                                99,  95,  90,  28,  29,  30,  33,  34,  37,
                                49,  50,  51,  54,  55,  58,  70,  71,  72,
                                75,  76,  79,  91,  92,  93,  96,  97, 100]),
    }

    to_pyfr = {k: np.argsort(v) for k, v in from_pyfr.items()}
